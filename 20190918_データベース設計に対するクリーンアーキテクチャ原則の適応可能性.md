新規事業におけるシステム開発は不確実性との戦いだ。
無論そこには事業自体の不確実性も含まれるが、本文ではとくにシステム設計で遭遇する不確実性に注目し「データベース設計に対するクリーンアーキテクチャ原則の適応可能性」を議論したい。

じつは筆者も現在、新規事業の開発を行うチームでシステム開発に携わっている。
近ごろはとりわけ新システムのデータベース設計を行なっているが、不確実が大きな障害物となっている。
具体的には、システムでモデリングする対象（と、システムでは扱わないと決めた対象）がある程度定まってきた一方で、それらの関係性の定義を決めきれずにいる。

不確実性を解消・軽減するために何らかのアクションが必要なことはチームの誰もが認識している。
しかしながら、事業の都合上MVPを用いて検証を繰り返すスタイルの開発が難しかったり、入社から日が浅くドメイン知識を十分に持たないメンバーが多いなど、不確実性を軽減するためのアクションを実行しづらいのが現状だ。
むしろ1on1やペアプロのような継続的な取り組み・改善のほうが、チーム内部の不確実性を減らすいう意味で実を結ぶ可能性が高いだろう。

では逆に、不確実性の大きなシステム設計に対して、技術的な側面から立ち向かう手立てはないのだろうか。
この問いに関しては、先人たちが発見した「遅延された意思決定」や「オプション性」といった概念が有用である。
つまり「『遅延された意思決定』が可能で、『オプション性』を与えてくれるシステム設計」を目指すのである。
「遅延された意思決定」や「オプション性」を備えたシステム設計を行うにあたり、クリーンアーキテクチャ（あるいはレイヤードアーキテクチャ）と呼ばれる設計技法が活躍する。

長くなったがここからようやく主題に入る。
「データベース設計に対するクリーンアーキテクチャ原則の適応可能性」だ。

クリーンアーキテクチャは複数の基本原則が組み合わされて構築されたシステム全体の設計技法である。
単一ファイルのクラス定義からマイクロサービス型の独立コンポーネントの定義までを議論の対象としている。
クリーンアーキテクチャはシステムに階層構造を定義することで不確実性を孕んだシステム開発に秩序を与える。
階層間には依存関係の方向性に関する決まりがあるが、「安定度が低い設計が高い方に依存する」原則はそのひとつだ。

筆者は安定度の概念がテーブル設計にも利用できることに気がついた。
すなわち、同じくテーブルとして表現された概念同士にも安定度の高低が存在するという仮説だ。

例えばStudentとClassroomという２つの概念を考えよう。
これらは生徒名や教室名といった属性を持ち、それは他の概念とは独立して意味をもつ。
また、生徒が教室に所属すること表現する概念としてClassroomMembershipを考えてみよう。
StudentとClassroomそれぞれの識別子を外部キーとして持つ中間テーブルだ。
ClassroomMembershipは概念としてStudentとClassroomに依存している。
この場合、StudentとClassroomはClassroomMembershipよりも高い安定度を持つと言える。

別の例として宿題内容を示す属性値と生徒の識別子をもつHomeworkを考えよう。
この場合、HomeworkとStudentの安定度に差はあるだろうか。
もしシステムがHomeworkを主要な機能のひとつとして捉えているなら、Studentと同等の安定度があると考えられる。
あるいはHomeworkの活用はまだ不確実性が高く検証が済んでいないなら、安定度は相対的にStudentよりも低くなる。

ところで、仮にモデリング対象の相対的な安定度（不確実性）が分かっているなら「安定度が低い設計が高い方に依存する」原則を適応できないだろうか。
つまり、HomeworkがStudentよりも低い安定度を持っているなら、Homeworkに生徒の識別子を持たせるのである。
あるいはHomeworkとStudentがシステムにとって同等の安定度を持つならば、別のより安定度の低い概念によってそれらのリレーションを定義する。
概念間の相対的な安定度が定義できれば、安定度をリレーション定義の方針として利用できるはずだ。

e.g. HomeworkがStudentに依存
Homework > Student

e.g. 安定度の低いAssignmentがHomeworkとStudentに依存
Homework < Assignment > Student

筆者の取り組んでいる事業はまだしばらく開発が続くだろう。
現状では本議論はまだ仮説レベルであるが、今後を開発続けていく中でなにか新たに気づくことがあるかもしれない。
その際には続編を記そうと思う。
