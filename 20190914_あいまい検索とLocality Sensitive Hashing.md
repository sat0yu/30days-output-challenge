「あいまい検索」と聞いて何を思い浮かべるだろうか。
例えば、検索エンジンと言えばGoogleがすぐに思い浮かぶが、当然ながら彼らもあいまい検索機能を提供している。
試しに「あいまい検索」と検索してみてほしい。おそらく「曖昧検索」にヒットしたページも結果に表示されるだろう。

本文では、我々が「あいまい検索」と呼んでいる機能の観察からはじめ、実装のひとつであるLocality Sensitive Hashingをみていきたい。

さて、今一度冒頭の質問にもどろう。
例として既にGoogleのあいまい検索を挙げたが、一方で、SQLのLIKE文は「あいまい検索」と呼べるだろうか。
あるいはSlackの絵文字検索はあいまい検索機能を実装していると言えるだろうか。

誤解を招かないよう、先に言葉の定義を済ませたいと思う。
ここでは「Fuzzy Search」に相当する単語として「あいまい検索」を利用する。
すなわち、「与えられた検索パターンに対してスペルミスやギャップも考慮して検索結果を返してくれる、あいまい性を含んだ検索」を指すものとする（この定義の場合、LIKE文はあいまい検索の範疇にない。）

単純な文字列（厳密）一致の場合には、オンライン検索で対象文字長lに対する線形時間O(l)、インデックスを用いればパターン長mの線形時間O(m)で検索を完了できる（KMPアルゴリズムや接尾辞木といったキーワードで検索すれば詳しい解説が見つかる）
しかし、あいまい性を含んだ検索を考える場合には厳密一致ほどうまくいかない。
なぜなら、あいまい性には定義からして不確定・確率的な要素が含まれており、厳密な理論的解析を行うことが難しいからだ。
あるいは逆に全てのあいまい性を受け入れ、あらゆるケースを完全に網羅した検索を考えると、その計算量は組合せ論的な様子を呈すことが予想される。

じつは、あいまい検索のタスクには上記で述べた文字列検索的なアプローチとは別に、実用的な近傍点探索のアプローチが存在する。
近傍点探索のアプローチでは、読んで字の如く、検索対象の集合Tと検索パターンPを同一空間内で表現（写像）し、Tの要素の中からPの近傍点を探し出す（散布図をイメージすると理解しやすいだろう。）

さらに、近傍点探索のアプローチとしてはとくにLocalitySensitiveHashを用いた近傍点探索手法が有名だ。
一般にハッシュ関数と言うときはハッシュ値が元のデータに依存せずに偏りなく分布することが望ましい。
ところが、LocalitySensitiveHashは似ているデータA,Bはそのハッシュ値H(A), H(B)も近い値を持つことが期待される。
LocalitySensitiveHashのこの性質を利用し、ハッシュ値の類似性であいまい検索を実現しようというのが、このアプローチのポイントだ。
ref. https://www.slideshare.net/yaruki_nil/lsh

例えば、以下表のような検索対象集合TとLocalitySensitiveHash関数hがあり、検索パターンP=“pineapple”であいまい検索を行うことを考えよう。

e.g. LocalitySensitiveHashな関数hと検索対象の集合T
|  i  |  T[I]           |  h(T[i])   |      
| -- | -------------- | ---------- |
| 1  | apple        |  12345   |
| 2  | lemon       |  23456   |
| 3  | orange      |  34567  |        

手順は非常に簡単だ。まずPに対して同じハッシュ関数hを適用する。
いま、h(P)=12356が得られたとしよう。あとはこの値と適当な閾値xを用いて検索をかければ良い。
すなわち、h(P) - x ≤ h(T[I]) ≤ h(P) + xを満たすT[i]をすべて集めれば、あいまい検索が完了する。
この例ではx=15程度に設定しておけば、あいまい検索の結果として「apple」が取得できる。

抽象的な議論が多く要諦が掴みづらい文章になってしまった。
近々、より具体的な例を用いてLocalitySensitiveHashの解説に再挑戦したい。
