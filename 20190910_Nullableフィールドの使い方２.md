昨日は、進化性の観点から、Nullable制約と互換性の関係を見てきた。
本文では「Nullableと空文字列をいかに使い分けるか」に関して考えてたい。

参照：Nullableフィールドの使い方に関する記事
https://blog.apollographql.com/using-nullability-in-graphql-2254f84c4ed7

データの型をもつシステム（プログラミング言語やGraphQLをはじめとるWebAPI）において、特定の値に対して特別な意味をもたせることがある。
例えば、Unix環境におけるプロセスは処理終了時に数値型の0を返すことで正常終了をOSに伝える。
あるいは、位置や長さといった概念を表す変数・フィールドは定義からして非負の値をもつことが期待できる。

ここで冒頭の問い「Nullableと空文字列をいかに使い分けるか」に戻りたい。
例えば、指名を表す変数nameがNullable指定されている場合、変数値がNullの場合と空文字列の場合は区別すべきだろうか。
この議論に正解はない。むしろ、開発の主体者の間で「どのようなポリシーを設定するか」という問いが正しい。

Nullableとゼロ値の扱いに関するポリシーを定めないことは、変数値の解釈の多義性を許容することを意味する。
そして解釈の多義性を許す以上、認識齟齬を防ぐために開発者間でコミュニケーションが要求されたり、あるいは齟齬があっても問題なく動作するように両方を状況を処理できるような実装が必要になる。

Null値とゼロ値との使い分けに関するポリシーは可能な限りプロジェクトの初期に設けることが望ましい。
昨日の議論で見たとおり、Nullable制約を課す（外す）操作はデータの入出力において互換性を壊す可能性があるからだ。
開発が進んだ後になってポリシーを設定する場合、互換性を破壊しないための検証は非常に大きな労力を要する。

じつは筆者が現在取り組むプロジェクトでは、これまでポリシーを設けずに開発を進めてきた。
そして先日、新しく追加されるエンドポイントのレスポンスフィールド定義においてチーム内で議論を設けた。
議論の末、「選択肢を狭めない」ことを理由にNullableなフィールドを追加することに至ったのだが、我々はNull値とゼロ値の意味付けに関するポリシーを持っていなかったため、それらの値に対して恣意的に意味付けを行ってしまった。

幸いなことにクライアントサイドではNull値もゼロ値も丸め込んで扱えるため、当面の間は問題にならないだろう。
とはいえ、フレームワークを変更したり、開発者が代わったり、その他さまざまな要因で問題は発生しうる。
つまり、null値とゼロ値にたいする認識の齟齬が、原因の特定が難しい類のバグとなって表出するのだ。
もしポリシーが設定されていてば、認識の齟齬を防ぎ、不必要な問題に悩まなくて済むだろう。
