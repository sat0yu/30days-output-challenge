EuRuKo 2019 - Surrounded by Microservices by Damir Svrtan
https://www.youtube.com/watch?v=YUX2tl3BMpw
数多くの凄腕エンジニアを抱えるNetflixにおいて、Railsを用いたヘキサゴナルアーキテクチャの実践経験を語った動画だ。

シンプルなRailsアプリケーションからスタートした彼らのNetflix
Studio（撮影動画の編集アプリケーション）は、徐々に何種類ものデータソースと通信するように変化した。
当初はActiveRecordの恩恵を最大限に活用し高速な開発を実現していたものの、アプリケーションの複雑度が高まるつれて開発速度が鈍化してきた。
そこでDamir氏はヘキサゴナルアーキテクチャを取り入れ、コンポーネントの階層構造を定義するとともに、その責務範囲を明確化した。

ヘキサゴナルアーキテクチャは階層構造によってコンポーネント間の依存関係に秩序をもたらす。
とくに彼らのエピソードとして語られていたのは、これまでActiveRecordが負っていた２つの責務（1: Entityの定義, 2:
データの取得方法)を分けた点だ。
Entityは安定度が高く抽象的な概念を表現し、データの取得方法は具体的で変わりやすい。
例えばデータ取得先をデータベースからインメモリキャッシュに変更するときも、Entityの定義まで変える必要はない。
データ取得先がマイクロサービスになる場合も同じ議論で、データの取得方法（アダプタ）を取り替えるだけで変更が完了する。

一般に、ヘキサゴナルアーキテクチャやレイヤードアーキテクチャ、あるいはクリーンアーキテクチャといった設計技工が語られる場合には静的型付け言語を前提とすることが多い。
多くの静的型付言語はインターフェースの概念を提供しており、インターフェースを用いて階層構造間の依存関係を自然な形で整理できることが、その理由のひとつだろう。
しかし、彼らNetflixでは動的型付けRubyでヘキサゴナルアーキテクチャを実践したのである。
Rubyの高い開発効率と、大規模開発を可能にするアーキテクチャの両方を手に入れたら、間違いなくその価値は大きい。

動画中では具体的なツール(gem)として次の３つが紹介されていた。
（Hanamiに関してはじつは彼らも使っておらず、むしろ使っていないことを強調するために引き合いに出しただけのようだ）

- https://github.com/dry-rb
- https://github.com/collectiveidea/interactor
- https://github.com/hanami/hanami

dry-rbは、例えて言えば「『UNIX哲学』を実践するツールのコレクション」だ。
Entityの型定義に用いるdry-types、値の検証を担うdry-validationなど、全18個のツールから構成される。
各ツールの説明と相互関係については、非常に洗練された説明を@hachi8833氏が公開しているので参照されたい。
https://techracho.bpsinc.jp/hachi8833/2017_11_16/47847

interactorはユースケースを実装するために利用される。
Entityどうしの関連や、Entityに対するビジネスロジックの適用といった手続きを記述する。
interactorを正しく用いれば、いわゆるFat-Controllerと呼ばれるようなバッドパターンを防げる。
こちらはTiago氏の記事（英語）が詳しい解説を記している。
https://goiabada.blog/interactors-in-ruby-easy-as-cake-simple-as-pie-33f66de2eb78

残念ながら、動画では上記tool(gem)の組み合わせ方までは踏み込んで解説がされていなかった。
データの取得方法が変わるケースは具体的なコードをスライドに移しながら説明があったので、興味があれば確認されたい。
